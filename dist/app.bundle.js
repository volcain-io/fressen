!function a(o,s,u){function c(t,e){if(!s[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[t]={exports:{}};o[t][0].call(i.exports,function(e){return c(o[t][1][e]||e)},i,i.exports,a,o,s,u)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,f,t){"use strict";!function(){function o(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function a(n,r,i){var a,e=new Promise(function(e,t){o(a=n[r].apply(n,i)).then(e,t)});return e.request=a,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return a(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=a(e,n,arguments)).then(function(e){if(e)return new s(e,t.request)});var e,t})})}function i(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function c(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function d(e){this._db=e}e(i,"_index",["name","keyPath","multiEntry","unique"]),t(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(s,"_cursor",["direction","key","primaryKey","value"]),t(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(s.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),o(t._request).then(function(e){if(e)return new s(e,t._request)})})})}),u.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},e(u,"_store",["name","keyPath","indexNames","autoIncrement"]),t(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},e(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},e(d,"_db",["name","version","objectStoreNames"]),n(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[u,i].forEach(function(e){a in e.prototype&&(e.prototype[a.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,i=r[a].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[i,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});var h={open:function(e,t,n){var r=a(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){n&&n(new l(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new d(e)})},delete:function(e){return a(indexedDB,"deleteDatabase",[e])}};void 0!==f?(f.exports=h,f.exports.default=f.exports):self.idb=h}()},{}],2:[function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&0<=Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime"),a=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=e("./runtime"),i)r.regeneratorRuntime=a;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},{"./runtime":3}],3:[function(e,T,t){!function(e){"use strict";var u,t=Object.prototype,c=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag",o="object"==typeof T,s=e.regeneratorRuntime;if(s)o&&(T.exports=s);else{(s=e.regeneratorRuntime=o?T.exports:{}).wrap=g;var d="suspendedStart",h="suspendedYield",f="executing",_="completed",v={},l={};l[i]=function(){return this};var p=Object.getPrototypeOf,m=p&&p(p(S([])));m&&m!==t&&c.call(m,i)&&(l=m);var y=E.prototype=w.prototype=Object.create(l);k.prototype=y.constructor=E,E.constructor=k,E[a]=k.displayName="GeneratorFunction",s.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(y),e},s.awrap=function(e){return{__await:e}},R(I.prototype),I.prototype[r]=function(){return this},s.AsyncIterator=I,s.async=function(e,t,n,r){var i=new I(g(e,t,n,r));return s.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},R(y),y[a]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},s.keys=function(n){var r=[];for(var e in n)r.push(e);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},s.values=S,B.prototype={constructor:B,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return a.type="throw",a.arg=n,r.next=e,t&&(r.method="next",r.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],a=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var o=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;j(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=u),v}}}function g(e,t,n,r){var a,o,s,u,i=t&&t.prototype instanceof w?t:w,c=Object.create(i.prototype),l=new B(r||[]);return c._invoke=(a=e,o=n,s=l,u=d,function(e,t){if(u===f)throw new Error("Generator is already running");if(u===_){if("throw"===e)throw t;return C()}for(s.method=e,s.arg=t;;){var n=s.delegate;if(n){var r=x(n,s);if(r){if(r===v)continue;return r}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(u===d)throw u=_,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);u=f;var i=b(a,o,s);if("normal"===i.type){if(u=s.done?_:h,i.arg===v)continue;return{value:i.arg,done:s.done}}"throw"===i.type&&(u=_,s.method="throw",s.arg=i.arg)}}),c}function b(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function k(){}function E(){}function R(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function I(u){var t;this._invoke=function(n,r){function e(){return new Promise(function(e,t){!function t(e,n,r,i){var a=b(u[e],u,n);if("throw"!==a.type){var o=a.arg,s=o.value;return s&&"object"==typeof s&&c.call(s,"__await")?Promise.resolve(s.__await).then(function(e){t("next",e,r,i)},function(e){t("throw",e,r,i)}):Promise.resolve(s).then(function(e){o.value=e,r(o)},i)}i(a.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}}function x(e,t){var n=e.iterator[t.method];if(n===u){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=u,x(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var r=b(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,v;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=u),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=u,e.done=!0,e};return r.next=r}}return{next:C}}function C(){return{value:u,done:!0}}}(function(){return this}()||Function("return this")())},{}],4:[function(e,t,n){"use strict";var r=a(e("./js/_controller.js")),i=(a(e("./js/_dbhelper_promises.js")),e("./js/_utils.js"));function a(e){return e&&e.__esModule?e:{default:e}}document.addEventListener("DOMContentLoaded",function(e){var t=new r.default;t.registerServiceWorker(),t.loadPage()}),window.onload=function(){(0,i.startIntersectionObserver)()},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)}},{"./js/_controller.js":7,"./js/_dbhelper_promises.js":8,"./js/_utils.js":10}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=function(){function i(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"Add";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this._elementId="btn-add-"+e,this._description=r,this._modal=t,this._handleClick=function(e){n._modal&&n._modal.open()}}return r(i,[{key:"_createNode",value:function(){var e=document.createElement("button");return e.id=this._elementId,e.classList.add("btn-add"),e.setAttribute("aria-label",this._description),e.append(this._createText()),e}},{key:"_createText",value:function(){var e=document.createElement("span");return e.classList.add("text-center"),e.classList.add("text-bigger"),e.textContent="+",e}},{key:"addEventListener",value:function(){document.getElementById(this._elementId).addEventListener("click",this._handleClick)}},{key:"removeEventListener",value:function(){document.getElementById(this._elementId).removeEventListener("click",this._handleClick)}},{key:"node",get:function(){return this._createNode()}}]),i}();n.default=i},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=e("./_dbhelper_promises.js"),o=(r=a)&&r.__esModule?r:{default:r};e("./_utils.js");var s=function(){function r(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"red";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this._data=e,this._id=e.id,this._flag=t,this._color=n,this._dbHelper=new o.default}return i(r,[{key:"toggle",value:function(e){this._flag=e,this.removeEventListener();var t=document.getElementById("favorite-"+this._id),n=this._createBtn();t.replaceWith(n),this.addEventListener()}},{key:"_createBtn",value:function(){var e=document.createElement("button"),t="true"===this._flag,n=(t?"Remove":"Add")+" restaurant "+(t?"from":"to")+" favorites";return e.id="favorite-"+this._id,e.setAttribute("data-isfavorite",t),e.setAttribute("aria-label",n),e.append(this._createImg(n)),e}},{key:"_createImg",value:function(e){var t=document.createElement("img"),n="true"===this._flag?"favorite":"favorite-border";return t.setAttribute("alt",e),t.setAttribute("src","./img/material-icons/"+n+"-"+this._color+".svg"),t}},{key:"_update",value:function(e){var t=this,n=document.getElementById("favorite-"+this._id);if(n){var r=!("true"===n.getAttribute("data-isfavorite"));this._dbHelper.updateFavoriteByRestaurant(this._data,r,!1).then(function(e){t._dbHelper.updateFavoriteByRestaurant(e,e.is_favorite,!0).then(function(e){return t.toggle(e.is_favorite)}).catch(function(e){return console.error(e)})}).catch(function(e){return console.error(e)})}}},{key:"addEventListener",value:function(){var t=this,e=document.getElementById("favorite-"+this._id);e&&e.addEventListener("click",function(e){return t._update(e)})}},{key:"removeEventListener",value:function(){var t=this,e=document.getElementById("favorite-"+this._id);e&&e.removeEventListener("click",function(e){return t._update(e)})}},{key:"node",get:function(){return this._createBtn()}},{key:"id",get:function(){return this._id}}]),r}();n.default=s},{"./_dbhelper_promises.js":8,"./_utils.js":10}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./_utils.js");var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._serviceWorkerURL="./../service-worker.js",this._serviceWorkerScope="./"}return r(e,[{key:"registerServiceWorker",value:function(){var t=this;if(!(!1 in navigator)){navigator.serviceWorker.register(this._serviceWorkerURL,{scope:this._serviceWorkerScope}).then(function(e){navigator.serviceWorker.controller&&(e.waiting?t._updateReady(e.waiting):e.installing?t._trackInstalling(e.installing):e.addEventListener("updatefound",function(){t._trackInstalling(e.installing)}))}).catch(function(e){return console.error("Failed to register ServiceWorker",e)});var n=void 0;navigator.serviceWorker.addEventListener("controllerchange",function(e){n||(window.location.origin===document.referrer&&window.location.reload(),n=!0)})}}},{key:"loadPage",value:function(){if(location)switch(location.pathname){case"/":(0,i.loadInstance)("index");break;case"/restaurant.html":(0,i.loadInstance)("restaurant")}}},{key:"_trackInstalling",value:function(e){var t=this;e.addEventListener("statechange",function(){console.log("Update state changed"),"installed"===e.state&&t._updateReady(e)})}},{key:"_updateReady",value:function(e){console.log("Update ready"),e.postMessage({action:"skipWaiting"})}}]),e}();n.default=a},{"./_utils.js":10}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),u=r(e("regenerator-runtime")),o=r(e("idb"));function r(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function c(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,n){try{var r=s[e](n),i=r.value}catch(e){return void o(e)}if(!r.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});a(i)}("next")})}}var l=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"object"===i(e.instance)?e.instance:(this._baseUrl="http://localhost:1337",this._dbRestaurantsRequest=new Request(this._baseUrl+"/restaurants"),this._dbNeighborhoodTypesRequest=new Request(this._baseUrl+"/neighborhoods"),this._dbCuisineTypesRequest=new Request(this._baseUrl+"/cuisines"),this._dbReviewsRequest=new Request(this._baseUrl+"/reviews"),this._stores={restaurants:"restaurants",neighborhoods:"neighborhoods",cuisines:"cuisines",reviews:"reviews"},this._restaurants=[],this._neighborhoods=[],this._cuisines=[],this._reviews=[],e.instance=this)}var t,n,r;return a(e,[{key:"initData",value:(r=c(u.default.mark(function e(){var n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"all";return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===this._stores.restaurants?3:e.t0===this._stores.neighborhoods?6:e.t0===this._stores.cuisines?7:e.t0===this._stores.reviews?8:9;break;case 3:return e.next=5,this._fetchRestaurants().then(function(e){var t;(t=n._restaurants).push.apply(t,s(e))}).then(function(){return n._addRestaurants(n._restaurants)});case 5:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",this._fetchNeighborhoods().then(function(e){var t;(t=n._neighborhoods).push.apply(t,s(e))}).then(function(){return n._addNeighborhoods(n._neighborhoods)}));case 7:return e.abrupt("return",this._fetchCuisines().then(function(e){var t;(t=n._cuisines).push.apply(t,s(e))}).then(function(){return n._addCuisines(n._cuisines)}));case 8:return e.abrupt("return",this._fetchReviews().then(function(e){var t;(t=n._reviews).push.apply(t,s(e))}).then(function(){return n._addReviews(n._reviews)}));case 9:return e.next=11,Promise.all([this._fetchRestaurants().then(function(e){var t;(t=n._restaurants).push.apply(t,s(e))}),this._fetchNeighborhoods().then(function(e){var t;(t=n._neighborhoods).push.apply(t,s(e))}),this._fetchCuisines().then(function(e){var t;(t=n._cuisines).push.apply(t,s(e))}),this._fetchReviews().then(function(e){var t;(t=n._reviews).push.apply(t,s(e))})]).then(function(){return n._addRestaurants(n._restaurants),n._addNeighborhoods(n._neighborhoods),n._addCuisines(n._cuisines),n._addReviews(n._reviews),Promise.resolve(!0)});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"_fillIdb",value:function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._stores.restaurants;return this.dbPromise.then(function(e){if(!e)return Promise.reject("db undefined");var t=e.transaction(i,"readwrite"),n=t.objectStore(i);return r&&(Array.isArray(r)?r.forEach(function(e){n.put(e)}):n.put(r)),t.complete}).then(function(){return r})}},{key:"_addRestaurants",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return this._fillIdb(e)}},{key:"_addNeighborhoods",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return this._fillIdb(e,this._stores.neighborhoods)}},{key:"_addCuisines",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return this._fillIdb(e,this._stores.cuisines)}},{key:"_addReviews",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return this._fillIdb(e,this._stores.reviews)}},{key:"addReview",value:function(e,t){var n=this;return t?this._fillIdb(e,this._stores.reviews).then(function(e){return n._reviews.push(e),e}):this._postData(this._dbReviewsRequest,e).then(function(e){return n._reviews.push(e),e})}},{key:"_getCachedDataByStore",value:function(){var t,i=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._stores.restaurants;return this.dbPromise.then((t=c(u.default.mark(function e(t){var n,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("db undefined"));case 2:return n=t.transaction(a),r=n.objectStore(a),e.next=6,r.getAll();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,i)})),function(e){return t.apply(this,arguments)})).then(function(e){return e&&0<e.length?e:Promise.reject("db info: store ${store} empty")})}},{key:"_getCachedDataByKey",value:function(i){var t,a=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._stores.restaurants;return this.dbPromise.then((t=c(u.default.mark(function e(t){var n,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("db undefined"));case 2:return n=t.transaction(o),r=n.objectStore(o),e.next=6,r.get(i);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,a)})),function(e){return t.apply(this,arguments)})).then(function(e){return e||Promise.reject("db info: data not found")})}},{key:"_getIDBStoreNameByRequest",value:function(e){switch(e.url){case this._dbNeighborhoodTypesRequest.url:return this._stores.neighborhoods;case this._dbCuisineTypesRequest.url:return this._stores.cuisines;case this._dbReviewsRequest.url:return this._stores.reviews;default:return this._stores.restaurants}}},{key:"_postData",value:(n=c(u.default.mark(function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:JSON.stringify(n)}).then(function(e){return e.json()});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_putData",value:(t=c(u.default.mark(function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"PUT",body:JSON.stringify(n)}).then(function(e){return e.json()});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_fetchData",value:function(t){var e=this._getIDBStoreNameByRequest(t);return this._getCachedDataByStore(e).catch(function(e){return fetch(t).then(function(e){return e.ok?e.json():Promise.reject(e.status)})})}},{key:"_fetchDataByKey",value:function(t,e){var n=this._getIDBStoreNameByRequest(t);return this._getCachedDataByKey(e,n).catch(function(e){return fetch(t).then(function(e){return e.ok?e.json():Promise.reject(e.status)})})}},{key:"_fetchRestaurants",value:function(){return this._fetchData(this._dbRestaurantsRequest)}},{key:"_fetchRestaurantById",value:function(e){return this._fetchDataByKey(this._dbRestaurantsRequest,e)}},{key:"_fetchNeighborhoods",value:function(){return this._fetchData(this._dbNeighborhoodTypesRequest)}},{key:"_fetchCuisines",value:function(){return this._fetchData(this._dbCuisineTypesRequest)}},{key:"_fetchReviews",value:function(){return this._fetchData(this._dbReviewsRequest)}},{key:"getRestaurantById",value:function(t){return this._restaurants.find(function(e){return e.id===parseInt(t)})}},{key:"getNeighborhoodById",value:function(t){return this._neighborhoods.find(function(e){return e.id===parseInt(t)})}},{key:"getCuisineById",value:function(t){return this._cuisines.find(function(e){return e.id===parseInt(t)})}},{key:"filterRestaurantByCuisineAndNeighborhood",value:function(t,n){if(this._restaurants){var e=this._restaurants;return-1!=t&&(e=e.filter(function(e){return e.cuisine_type_id==t})),-1!=n&&(e=e.filter(function(e){return e.neighborhood_type_id==n})),e}return null}},{key:"getReviewsByRestaurantId",value:function(t){return this._reviews.filter(function(e){return e.restaurant_id==t})}},{key:"_updateReview",value:function(e){var t=e.id,n=e.name,r=e.rating,i=e.comments,a=new URL(this._dbReviewsRequest.url+"/"+t);return this._putData(a,{name:n,rating:r,comments:i})}},{key:"updateReviews",value:function(){var o=this;return this._getCachedDataByStore(this._stores.reviews).then(function(e){return Promise.all(e.map(function(a){var e=new URL(o._dbReviewsRequest.url+"/"+a.id);return fetch(e).then(function(e){if(e&&e.ok)return o._updateReview(a).then(function(t){var e=o._reviews.findIndex(function(e){return e.id===t.id});return o._reviews.splice(e,1,t),t});var t=a.restaurant_id,n=a.name,r=a.rating,i=a.comments;return o.addReview({restaurant_id:t,name:n,rating:r,comments:i},!1).then(function(e){return o._reviews.push(e),e})}).catch(function(e){return function(e){return console.error(e)}})})).catch(function(e){return console.error(e)})})}},{key:"updateFavoriteByRestaurant",value:function(a,o,e){var s=this;if(e)return this.dbPromise.then((t=c(u.default.mark(function e(t){var n,r,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("db undefined"));case 2:return n=t.transaction(s._stores.restaurants,"readwrite"),r=n.objectStore(s._stores.restaurants),e.next=6,r.get(parseInt(a.id));case 6:return(i=e.sent).is_favorite=o,r.put(i),e.abrupt("return",n.complete);case 10:case"end":return e.stop()}},e,s)})),function(e){return t.apply(this,arguments)})).then(function(){return s._fetchRestaurantById().then(function(e){return s._restaurants.splice(0).push(e),e.find(function(e){return e.id===a.id})})});var t,n=new URL(this._dbRestaurantsRequest.url+"/"+a.id+"/?is_favorite="+o);return this._putData(n).then(function(t){var e=s._restaurants.findIndex(function(e){return e.id===t.id});return s._restaurants.splice(e,1,t),t})}},{key:"restaurants",get:function(){return this._restaurants}},{key:"neighborhoods",get:function(){return this._neighborhoods}},{key:"cuisines",get:function(){return this._cuisines}},{key:"reviews",get:function(){return this._reviews}},{key:"stores",get:function(){return this._stores}},{key:"dbPromise",get:function(){var t=this;return o.default.open("fressen-db",2,function(e){switch(e.oldVersion){case 0:e.objectStoreNames.contains(t._stores.restaurants)||e.createObjectStore(t._stores.restaurants,{keyPath:"id"}),e.objectStoreNames.contains(t._stores.neighborhoods)||e.createObjectStore(t._stores.neighborhoods,{keyPath:"id"}),e.objectStoreNames.contains(t._stores.cuisines)||e.createObjectStore(t._stores.cuisines,{keyPath:"id"});case 1:e.objectStoreNames.contains(t._stores.reviews)||e.createObjectStore(t._stores.reviews,{keyPath:"id",autoIncrement:!0})}})}}]),e}(),d=new l;Object.freeze(d),n.default=l},{idb:1,"regenerator-runtime":2}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(e){e.preventDefault(),console.warn("No callback defined.")},t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"modal",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"modal-overlay";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this._btnOkCallback=e,this._modal=document.getElementById(n),this._modalOverlay=document.getElementById(r),this._focusedElementBeforeModal=null,this._focusableElementsString='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex="0"], [contenteditable]',this._firstTabStop=null,this._lastTabStop=null,this._btnOk=null,this._btnClose=null,this._isClosed=!0,this._trapTabKey=function(e){9===e.keyCode&&(e.shiftKey?document.activeElement===t._firstTabStop&&(e.preventDefault(),t._lastTabStop.focus()):document.activeElement===t._lastTabStop&&(e.preventDefault(),t._firstTabStop.focus())),27===e.keyCode&&t._closeModal(e)},this._closeModal=function(e){t._removeEventListeners(),t._resetForms(),t._hide(),t._isClosed=!0,t._focusedElementBeforeModal&&t._focusedElementBeforeModal.focus()},this._closeModal()}return r(i,[{key:"open",value:function(){if(this._isClosed){this._focusedElementBeforeModal=document.activeElement,this._btnOk=document.getElementById("modal-btn-ok"),this._btnClose=document.getElementById("modal-btn-close"),this._addEventListeners();var e=null;this._modal&&this._focusableElementsString&&(e=[].concat(a(this._modal.querySelectorAll(this._focusableElementsString)))),this._show(),e&&(this._firstTabStop=e[0],this._lastTabStop=e[e.length-1]),this._firstTabStop&&this._firstTabStop.focus()}}},{key:"close",value:function(){this._closeModal()}},{key:"_hasFormAsChildren",value:function(){var e=null;if(this._modal){var t=[].concat(a(this._modal.childNodes));t&&0<t.length&&(e=t.filter(function(e){return"FORM"===e.tagName}))}return e}},{key:"_resetForms",value:function(){var e=this._hasFormAsChildren();e&&e.forEach(function(e){return e.reset()})}},{key:"_addEventListeners",value:function(){this._modal&&this._modal.addEventListener("keydown",this._trapTabKey),this._btnOk&&this._btnOk.addEventListener("click",this._btnOkCallback),this._btnClose&&this._btnClose.addEventListener("click",this._closeModal)}},{key:"_removeEventListeners",value:function(){this._modal&&this._modal.removeEventListener("keydown",this._trapTabKey),this._btnOk&&this._btnOk.removeEventListener("click",this._btnOkCallback),this._btnClose&&this._btnClose.removeEventListener("click",this._closeModal)}},{key:"_show",value:function(){this._modal&&(this._modal.style.display="block"),this._modalOverlay&&(this._modalOverlay.style.display="block"),this._isClosed=!1}},{key:"_hide",value:function(){this._modal&&(this._modal.style.display="none"),this._modalOverlay&&(this._modalOverlay.style.display="none")}}]),i}();n.default=i},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mapMarkerForRestaurant=n.convertUnixTimeStampToHuman=n.getOperatingHours=n.calculateRatingByReviews=n.urlForRestaurant=n.startIntersectionObserver=n.handleIntersection=n.fetchImage=n.loadImage=n.loadMap=n.loadInstance=n.getId=n.getParameterByName=void 0;var r=a(e("./restaurant.js")),i=a(e("./index.js"));function a(e){return e&&e.__esModule?e:{default:e}}n.getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},n.getId=function e(t){var n="neighborhood-",r="cuisine-",i="restaurant-",a="favorite-";return t?t.id?t.id.startsWith(n)?t.id.replace(n,""):t.id.startsWith(r)?t.id.replace(r,""):t.id.startsWith(i)?t.id.replace(i,""):t.id.startsWith(a)?t.id.replace(a,""):e(t.parentElement):e(t.parentElement):-1},n.loadInstance=function(e){switch(e){case"restaurant":new r.default;break;default:new i.default}},n.loadMap=function(){var e=document.getElementById("map");if(e){if("undefined"!=typeof google){return new google.maps.Map(e,{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1})}var t=document.createElement("h3");t.classList.add("error"),t.textContent="Google Maps not available",e.appendChild(t)}return null};var o=n.loadImage=function(e){var t=e.dataset.srcset.split(","),n=1===window.devicePixelRatio?t[0].replace(" 1x",""):t[1].replace(" 2x","");s(n).then(function(){e.src=n})},s=n.fetchImage=function(r){return new Promise(function(e,t){var n=new Image;n.src=r,n.onload=e,n.onerror=t})},u=n.handleIntersection=function(e,t){e.forEach(function(e){0<e.intersectionRatio&&(t.unobserve(e.target),o(e.target))})},c=(n.startIntersectionObserver=function(){var t=new IntersectionObserver(u,{rootMargin:"0px",threshold:[.1]});document.querySelectorAll("img.restaurant-img").forEach(function(e){t.observe(e)})},n.urlForRestaurant=function(e){return"./restaurant.html?id="+e});n.calculateRatingByReviews=function(e){return e?(e.reduce(function(e,t){return e+Number(t.rating)},0)/e.length).toFixed(1):"-"},n.getOperatingHours=function(e){return e?e[["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][(new Date).getDay()]].replace(","," &"):"N.A."},n.convertUnixTimeStampToHuman=function(e){return Number.isInteger(e)?new Date(e).toLocaleString():(new Date).toLocaleString()},n.mapMarkerForRestaurant=function(e,t){return"undefined"==typeof google?null:new google.maps.Marker({position:e.latlng,title:e.name,url:c(e.id),map:t,animation:google.maps.Animation.DROP})}},{"./index.js":11,"./restaurant.js":12}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=a(e("./_dbhelper_promises.js")),l=a(e("./_btn-favorite.js")),p=e("./_utils.js");function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._restaurants=[],this._neighborhoods=[],this._cuisines=[],this._reviews=[],this._map=null,this._markers=[],this._btnFavorites=[],this._selectedNeighborhoodId=-1,this._selectedCuisineId=-1,this._dbHelper=new i.default,this._init()}return r(e,[{key:"_init",value:function(){var e=this;Promise.all([this._dbHelper.initData(this._dbHelper.stores.neighborhoods).then(function(){e._neighborhoods=e._dbHelper.neighborhoods,requestAnimationFrame(function(){return e._fillNeighborhoodsHTML()})}),this._dbHelper.initData(this._dbHelper.stores.cuisines).then(function(){e._cuisines=e._dbHelper.cuisines,requestAnimationFrame(function(){return e._fillCuisinesHTML()})}),this._dbHelper.initData(this._dbHelper.stores.reviews).then(function(){return e._reviews=e._dbHelper.reviews,e._dbHelper.initData(e._dbHelper.stores.restaurants)}).then(function(){e._restaurants=e._dbHelper.restaurants,requestAnimationFrame(function(){return e._fillRestaurantsHTML()})})]).catch(function(e){return console.error()})}},{key:"_updateUI",value:function(){this._fillNeighborhoodsHTML(),this._fillCuisinesHTML(),this._updateRestaurants()}},{key:"_showMap",value:function(){var e=document.getElementById("map");e&&e.classList.remove("hide")}},{key:"_addEventListeners",value:function(){var r=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"restaurant";switch(i){case"neighborhood":case"cuisine":var e=document.querySelectorAll('div[id^="'+i+'-"]'),t=function(n){n.addEventListener("click",function(e){var t=n.id.replace(i+"-","");"neighborhood"===i&&(r._selectedNeighborhoodId=t),"cuisine"===i&&(r._selectedCuisineId=t),r._showMap(),r._updateSelection(i),r._updateRestaurants()})},n=!0,a=!1,o=void 0;try{for(var s,u=e[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){t(s.value)}}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}break;default:var c=document.querySelectorAll("div.inner-places"),l=function(e){var t=e.parentElement.id.replace("restaurant-","");e.addEventListener("click",function(e){window.location.replace((0,p.urlForRestaurant)(t))})},d=!0,h=!1,f=void 0;try{for(var _,v=c[Symbol.iterator]();!(d=(_=v.next()).done);d=!0){l(_.value)}}catch(e){h=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(h)throw f}}this._btnFavorites.forEach(function(e){return e.addEventListener()})}}},{key:"_addBtnFavorites",value:function(){this._btnFavorites&&this._btnFavorites.forEach(function(e){e&&document.getElementById("restaurant-"+e.id).appendChild(e.node)})}},{key:"_updateSelection",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"neighborhood",t="neighborhood"===e?this._selectedNeighborhoodId:this._selectedCuisineId,n=document.querySelectorAll('div[id^="'+e+'-"]'),r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;u.id===e+"-"+t?u.classList.toggle("selected"):u.classList.remove("selected"),u.setAttribute("aria-selected",u.classList.contains("selected"))}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}0===(n=document.querySelectorAll('div[id^="'+e+'-"][aria-selected="true"]')).length&&("neighborhood"===e&&(this._selectedNeighborhoodId=-1),"cuisine"===e&&(this._selectedCuisineId=-1))}},{key:"_fillNeighborhoodsHTML",value:function(){if(this._neighborhoods&&0<this._neighborhoods.length){var e=document.getElementById("neighborhood-template").innerHTML,t="",n=!0,r=!1,i=void 0;try{for(var a,o=this._neighborhoods[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t+=e.replace(/{id}/g,s.id).replace(/{name}/g,s.name).replace(/{icon}/g,s.icon).replace(/{altText}/g,s.altText)}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}document.getElementById("neighborhoods").innerHTML=t,this._addEventListeners("neighborhood")}}},{key:"_fillCuisinesHTML",value:function(){if(this._cuisines&&0<this._cuisines.length){var e=document.getElementById("cuisine-template").innerHTML,t="",n=!0,r=!1,i=void 0;try{for(var a,o=this._cuisines[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t+=e.replace(/{id}/g,s.id).replace(/{name}/g,s.name).replace(/{icon}/g,s.icon).replace(/{altText}/g,s.altText)}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}document.getElementById("cuisines").innerHTML=t,this._addEventListeners("cuisine")}}},{key:"_filterReviewsByRestaurantId",value:function(t){return this._reviews?this._reviews.filter(function(e){return e.restaurant_id===t}):null}},{key:"_fillRestaurantsHTML",value:function(){var e=document.getElementById("restaurants");if(this._restaurants&&0<this._restaurants.length){var t=document.getElementById("restaurant-template").innerHTML,n="",r=!0,i=!1,a=void 0;try{for(var o,s=this._restaurants[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n+=t.replace(/{id}/g,u.id).replace(/{name}/g,u.name).replace(/{address}/g,u.address).replace(/{operatingHours}/g,(0,p.getOperatingHours)(u.operating_hours)).replace(/{rating}/g,(0,p.calculateRatingByReviews)(this._filterReviewsByRestaurantId(u.id)));var c=new l.default(u,u.is_favorite);this._btnFavorites.push(c)}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}e&&(e.innerHTML=n),this._addBtnFavorites(),(0,p.startIntersectionObserver)(),this._addMarkersToMap(),this._addEventListeners()}else e&&(e.innerHTML=document.getElementById("empty-view").innerHTML)}},{key:"_updateRestaurants",value:function(){this._resetRestaurants(),this._restaurants=this._dbHelper.filterRestaurantByCuisineAndNeighborhood(this._selectedCuisineId,this._selectedNeighborhoodId),this._fillRestaurantsHTML()}},{key:"_resetRestaurants",value:function(){if(this._restaurants=[],document.getElementById("restaurants").innerHTML="",this._markers){var e=!0,t=!1,n=void 0;try{for(var r,i=this._markers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;a&&a.setMap(null)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}this._markers=[],this._btnFavorites&&this._btnFavorites.forEach(function(e){e&&e.removeEventListener()}),this._btnFavorites=[]}},{key:"_addMarkersToMap",value:function(){var n=this,r=0,i=0;if(this._map||(this._map=(0,p.loadMap)()),this._map){var e=function(e){var t=(0,p.mapMarkerForRestaurant)(e,n._map);n._markers.push(t),google.maps.event.trigger(n._map,"resize"),google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),r+=e.latlng.lat,i+=e.latlng.lng},t=!0,a=!1,o=void 0;try{for(var s,u=this._restaurants[Symbol.iterator]();!(t=(s=u.next()).done);t=!0){e(s.value)}}catch(e){a=!0,o=e}finally{try{!t&&u.return&&u.return()}finally{if(a)throw o}}r/=this._restaurants.length,i/=this._restaurants.length,this._map.setCenter({lat:r,lng:i})}}}]),e}();n.default=o},{"./_btn-favorite.js":6,"./_dbhelper_promises.js":8,"./_utils.js":10}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=u(e("./_dbhelper_promises.js")),a=u(e("./_btn-favorite.js")),o=u(e("./_btn-add.js")),s=u(e("./_modal.js")),c=e("./_utils.js");function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._restaurant="",this._neighborhood="",this._cuisine="",this._reviews=[],this._map=null,this._modalDialog=new s.default(this._postData.bind(this)),this._dbHelper=new i.default,this._init()}return r(e,[{key:"_init",value:function(){var t=this;this._dbHelper.initData().then(function(){var e=(0,c.getParameterByName)("id");t._restaurant=t._dbHelper.getRestaurantById(e),t._restaurant&&(t._neighborhood=t._dbHelper.getNeighborhoodById(t._restaurant.neighborhood_type_id),t._cuisine=t._dbHelper.getCuisineById(t._restaurant.cuisine_type_id),t._reviews=t._dbHelper.getReviewsByRestaurantId(t._restaurant.id)),t._updateUI()}).catch(function(e){return console.error(e)})}},{key:"_updateUI",value:function(){this._restaurant&&(document.getElementById("title").textContent+=this._restaurant.name,document.getElementById("restaurant-name").textContent=this._restaurant.name,document.getElementById("breadcrumb-name").textContent=this._restaurant.name,this._fillRestaurantHTML())}},{key:"_showMap",value:function(){this._restaurant&&(this._map||(this._map=(0,c.loadMap)()),this._map&&(this._map.setCenter(this._restaurant.latlng),(0,c.mapMarkerForRestaurant)(this._restaurant,this._map)))}},{key:"_fillRestaurantHTML",value:function(){var e=document.getElementById("restaurant-template").innerHTML,t="";if(e){var n=(0,c.calculateRatingByReviews)(this._reviews);t+=e.replace(/{id}/g,this._restaurant.id).replace(/{name}/g,this._restaurant.name).replace(/{lat}/g,this._restaurant.latlng.lat).replace(/{lng}/g,this._restaurant.latlng.lng).replace(/{address}/g,this._restaurant.address).replace(/{rating}/g,n)}var r=document.getElementById("restaurant-container");r&&(r.innerHTML=t),this._fillRestaurantHours(),this._fillNeighborhood(),this._fillCuisine(),this._fillReviewsHTML(),this._fillBtnFavorite(),this._fillBtnAdd(),this._showMap()}},{key:"_fillRestaurantHours",value:function(){var e=document.getElementById("operating-hours-all");if(this._restaurant&&this._restaurant.operating_hours){var t=this._restaurant.operating_hours;for(var n in t){var r=document.createElement("tr");r.setAttribute("aria-label",n+" open from "+t[n]);var i=document.createElement("td");i.innerHTML=n,r.appendChild(i);var a=document.createElement("td");a.innerHTML=t[n],r.appendChild(a),e.appendChild(r)}}else{var o=document.createElement("tr");o.setAttribute("aria-label","No Operating Hours available.");var s=document.createElement("td");s.textContent="No Operating Hours available.",o.appendChild(s),e.appendChild(o)}}},{key:"_fillNeighborhood",value:function(){if(this._neighborhood){var e=this._dbHelper.getNeighborhoodById(this._neighborhood.id),t=document.getElementById("neighborhood-name");t&&(t.textContent="in "+e.name)}}},{key:"_fillCuisine",value:function(){if(this._cuisine){var e=this._dbHelper.getCuisineById(this._cuisine.id),t=document.getElementById("cuisine-name");t&&(t.textContent=e.name)}}},{key:"_fillReviewsHTML",value:function(){var e=document.getElementById("reviews");if(this._reviews&&0<this._reviews.length){var t=document.getElementById("review-template").innerHTML,n="",r=!0,i=!1,a=void 0;try{for(var o,s=this._reviews[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n+=t.replace(/{id}/g,u.id).replace(/{name}/g,u.name).replace(/{date}/g,(0,c.convertUnixTimeStampToHuman)(u.updatedAt)).replace(/{rating}/g,u.rating).replace(/{comments}/g,u.comments)}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}e&&(e.innerHTML=n)}else e&&(e.innerHTML=document.getElementById("empty-view").innerHTML)}},{key:"_fillBtnFavorite",value:function(){var e=new a.default(this._restaurant,this._restaurant.is_favorite,"white");document.getElementsByTagName("nav").item(0).appendChild(e.node),e.addEventListener()}},{key:"_fillBtnAdd",value:function(){var e=new o.default(this._restaurant.id,this._modalDialog,"Add a new review");document.getElementsByTagName("main").item(0).appendChild(e.node),e.addEventListener()}},{key:"_postData",value:function(e){var t=this,n=document.getElementById("form-review"),r=new FormData(n);r.append("restaurant_id",this._restaurant.id);var i=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r.values())),a=i[0],o=i[1],s=i[2],u=i[3],c={restaurant_id:u,name:a,rating:o,comments:s};c.restaurant_id&&c.name&&c.rating&&c.comments&&(e.preventDefault(),this._dbHelper.addReview(c,!0).then(function(e){return"serviceWorker"in navigator&&"SyncManager"in window?navigator.serviceWorker.ready.then(function(e){return e.sync.register("syncIndexedDB")}).then(function(){return Promise.resolve(e)}).catch(function(){return console.warn("Unable to register Background Sync"),t._dbHelper.updateReviews().then(function(){return Promise.resolve(e)})}):(console.warn("ServiceWorker and Background Sync not supported"),t._dbHelper.updateReviews().then(function(){return Promise.resolve(e)}))}).then(function(e){t._modalDialog.close(),t._reviews=t._dbHelper.getReviewsByRestaurantId(u),t._fillReviewsHTML()}).catch(function(e){console.error(e)}))}}]),e}();n.default=l},{"./_btn-add.js":5,"./_btn-favorite.js":6,"./_dbhelper_promises.js":8,"./_modal.js":9,"./_utils.js":10}]},{},[4]);